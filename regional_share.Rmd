---
title: "Regional Share Analysis"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, echo = FALSE, cache = TRUE, fig.width = 8)

require(tidyverse)
require(sf)
require(areal)
require(ggplot2)
require(rpgcolorsr)
require(gridExtra)
require(kableExtra)
require(ggrepel)
require(tmap)
require(rmapshaper)
library(scales)
library(gridExtra)

options(scipen = 999)

#devtools::install_github("BFroebRPG/rpgcolorsr")

```


```{r read in data}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, echo = FALSE)

zones_land <- readRDS("K:\\Projects\\D1\\Features\\Lakeland_AAA_Phase3\\US98\\TOD_Land_Use_Analysis\\zones_land.rds")

corrido <- readRDS("K:\\Projects\\D1\\Features\\Lakeland_AAA_Phase3\\US98\\TOD_Land_Use_Analysis\\corridor.rds")

station_buffers <- readRDS("K:\\Projects\\D1\\Features\\Lakeland_AAA_Phase3\\US98\\TOD_Land_Use_Analysis\\station_buffers.rds")

station_points <- readRDS("K:\\Projects\\D1\\Features\\Lakeland_AAA_Phase3\\US98\\TOD_Land_Use_Analysis\\station_points.rds")

corridor_buffer_half <- readRDS("K:\\Projects\\D1\\Features\\Lakeland_AAA_Phase3\\US98\\TOD_Land_Use_Analysis\\corridor_buffer_half.rds")

#corridor_parcels <- readRDS("K:\\Projects\\D1\\Features\\Lakeland_AAA_Phase3\\US98\\TOD_Land_Use_Analysis\\corridor_parcels.rds")

```

The following charts reveal the distribution of forecasted dwelling unit and employment growth between the corridor and non-corridor area under the 2045 land use scenario. They reveal the share of regional growth expected to occur inside and outside the corridor. A "target" scenario was developed to reveal what the growth distributions would look like if enough of the expected regional growth was concentrated in the corridor in order to reach minimum BRT density targets for jobs and dwelling units.

```{r}

growth_scenarios_emp <- data.frame()

#Emp growth foretasted in corridor
growth_scenarios_emp[1,1] <- area_weighted_corridor_results_EMP$TotEmp2045-area_weighted_corridor_results_EMP$TotEmp2020
growth_scenarios_emp[1,2] <- "inside corridor" 
growth_scenarios_emp[1,3] <- "model scenario" 


#county and corridor growth foretasted in model
county_growth_emp <- sum(zones_land$TotEmp2045)-sum(zones_land$TotEmp2020)
corridor_emp_growth_model <- area_weighted_corridor_results_EMP$TotEmp2045-area_weighted_corridor_results_EMP$TotEmp2020

growth_scenarios_emp[2,1] <- county_growth_emp - corridor_emp_growth_model
growth_scenarios_emp[2,2] <- "outside corridor" 
growth_scenarios_emp[2,3] <- "model scenario" 

#growth of corridor to hit target
corridor_growth_emp_target_scenario <- (area_weighted_corridor_results_EMP$acres*10)-(area_weighted_corridor_results_EMP$TotEmp2020)

growth_scenarios_emp[3,1] <- corridor_growth_emp_target_scenario
growth_scenarios_emp[3,2] <- "inside corridor" 
growth_scenarios_emp[3,3] <- "target scenario" 

growth_scenarios_emp[4,1] <- (county_growth_emp - corridor_growth_emp_target_scenario)
growth_scenarios_emp[4,2] <- "outside corridor" 
growth_scenarios_emp[4,3] <- "target scenario" 

colnames(growth_scenarios_emp) <- c("employment", "area", "scenario")

gg_emp_growth <- ggplot(data=growth_scenarios_emp, aes(x=scenario, y=employment, fill=area)) +
  geom_bar(stat="identity") +
  scale_fill_rpg(palette = "rpg_colors") +
  xlab("") +
  ylab("Employment Growth") +
  ggtitle("Job Growth by Scenario") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))


#pop growth scenario evaluation

growth_scenarios_du <- data.frame()

#Emp growth foretasted in corridor
growth_scenarios_du[1,1] <- area_weighted_corridor_results_DU$Tot_DU_45-area_weighted_corridor_results_DU$Tot_DU_20
growth_scenarios_du[1,2] <- "inside corridor" 
growth_scenarios_du[1,3] <- "model scenario" 


#county and corridor growth foretasted in model
county_growth_du <- sum(zones_land$Tot_DU_45)-sum(area_weighted_corridor_results_DU$Tot_DU_20)
corridor_du_growth_model <- area_weighted_corridor_results_DU$Tot_DU_45-area_weighted_corridor_results_DU$Tot_DU_20

growth_scenarios_du[2,1] <- county_growth_du - corridor_du_growth_model
growth_scenarios_du[2,2] <- "outside corridor" 
growth_scenarios_du[2,3] <- "model scenario" 

#growth of corridor to hit target
corridor_growth_du_target_scenario <- (area_weighted_corridor_results_DU$acres*7)-(area_weighted_corridor_results_DU$Tot_DU_20)

growth_scenarios_du[3,1] <- corridor_growth_du_target_scenario
growth_scenarios_du[3,2] <- "inside corridor" 
growth_scenarios_du[3,3] <- "target scenario" 

growth_scenarios_du[4,1] <- (county_growth_du - corridor_growth_du_target_scenario)
growth_scenarios_du[4,2] <- "outside corridor" 
growth_scenarios_du[4,3] <- "target scenario" 

colnames(growth_scenarios_du) <- c("du", "area", "scenario")

gg_du_growth <- ggplot(data=growth_scenarios_du, aes(x=scenario, y=du, fill=area)) +
  geom_bar(stat="identity") +
  scale_fill_rpg(palette = "rpg_colors") +
  xlab("") +
  ylab("DU Growth") +
  ggtitle("DU Growth by Scenario") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))

grid.arrange(gg_emp_growth, gg_du_growth, ncol=2)


```
